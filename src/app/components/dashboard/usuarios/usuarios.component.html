<div class="usuarios-wrapper">
  <div class="usuarios-header">
    <h2>Gerenciar Usu√°rios</h2>
    <button class="btn btn-primary" (click)="toggleForm()" *ngIf="!showForm">
      <i class="fas fa-plus"></i> Novo Usu√°rio
    </button>
  </div>

  <!-- Alertas -->
  <div class="alert alert-success" *ngIf="successMessage" (click)="successMessage = ''">
    {{ successMessage }}
  </div>
  <div class="alert alert-danger" *ngIf="errorMessage" (click)="errorMessage = ''">
    {{ errorMessage }}
  </div>

  <!-- Formul√°rio de cadastro -->
  <div class="usuarios-form" *ngIf="showForm">
    <form [formGroup]="usuariosForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="name">Nome Completo *</label>
          <input 
            type="text" 
            id="name" 
            formControlName="name" 
            placeholder="Digite o nome completo"
            [class.invalid]="usuariosForm.get('name')?.invalid && usuariosForm.get('name')?.touched">
          <div class="error-message" *ngIf="usuariosForm.get('name')?.invalid && usuariosForm.get('name')?.touched">
            <span *ngIf="usuariosForm.get('name')?.errors?.['required']">Nome √© obrigat√≥rio</span>
            <span *ngIf="usuariosForm.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</span>
          </div>
        </div>

        <div class="form-group">
          <label for="email">E-mail *</label>
          <input 
            type="email" 
            id="email" 
            formControlName="email" 
            placeholder="Digite o e-mail"
            [class.invalid]="usuariosForm.get('email')?.invalid && usuariosForm.get('email')?.touched">
          <div class="error-message" *ngIf="usuariosForm.get('email')?.invalid && usuariosForm.get('email')?.touched">
            <span *ngIf="usuariosForm.get('email')?.errors?.['required']">E-mail √© obrigat√≥rio</span>
            <span *ngIf="usuariosForm.get('email')?.errors?.['email']">E-mail inv√°lido</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="password">Senha *</label>
          <input 
            type="password" 
            id="password" 
            formControlName="password" 
            placeholder="Digite a senha"
            [class.invalid]="usuariosForm.get('password')?.invalid && usuariosForm.get('password')?.touched">
          <div class="error-message" *ngIf="usuariosForm.get('password')?.invalid && usuariosForm.get('password')?.touched">
            <span *ngIf="usuariosForm.get('password')?.errors?.['required']">Senha √© obrigat√≥ria</span>
            <span *ngIf="usuariosForm.get('password')?.errors?.['minlength']">Senha deve ter pelo menos 6 caracteres</span>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar Senha *</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            placeholder="Confirme a senha"
            [class.invalid]="usuariosForm.get('confirmPassword')?.invalid && usuariosForm.get('confirmPassword')?.touched">
          <div class="error-message" *ngIf="usuariosForm.get('confirmPassword')?.invalid && usuariosForm.get('confirmPassword')?.touched">
            <span *ngIf="usuariosForm.get('confirmPassword')?.errors?.['required']">Confirma√ß√£o de senha √© obrigat√≥ria</span>
            <span *ngIf="usuariosForm.get('confirmPassword')?.errors?.['passwordMismatch']">Senhas n√£o coincidem</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="role">Tipo de Usu√°rio *</label>
        <select 
          id="role" 
          formControlName="role"
          [class.invalid]="usuariosForm.get('role')?.invalid && usuariosForm.get('role')?.touched">
          <option value="user">Usu√°rio</option>
          <option value="admin">Administrador</option>
          <option value="superAdmin">Super Administrador</option>
        </select>
        <div class="error-message" *ngIf="usuariosForm.get('role')?.invalid && usuariosForm.get('role')?.touched">
          <span *ngIf="usuariosForm.get('role')?.errors?.['required']">Tipo de usu√°rio √© obrigat√≥rio</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="toggleForm()" [disabled]="loading">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="usuariosForm.invalid || loading">
          <span *ngIf="!loading">Cadastrar Usu√°rio</span>
          <span *ngIf="loading">Cadastrando...</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de usu√°rios -->
  <div class="usuarios-lista" *ngIf="!showForm">
    <div class="usuarios-table-container">
      <table class="usuarios-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>E-mail</th>
            <th>Tipo</th>
            <th>Data de Cadastro</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of usuarios" class="usuario-row">
            <td class="nome-cell">
              <strong>{{ usuario.name }}</strong>
            </td>
            <td class="email-cell">
              {{ usuario.email }}
            </td>
            <td class="role-cell">
              <span class="role-badge" [class]="getRoleClass(usuario.role)">
                {{ getRoleText(usuario.role) }}
              </span>
            </td>
            <td class="data-cell">
              {{ usuario.createdAt }}
            </td>
            <td class="acoes-cell">
              <div class="acoes-buttons">
                <button class="btn-icon btn-edit" title="Editar usu√°rio">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-delete" 
                        (click)="deletarUsuario(usuario.id)" 
                        title="Deletar usu√°rio">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Estado vazio -->
    <div class="empty-state" *ngIf="usuarios.length === 0">
      <div class="empty-icon">üë•</div>
      <h3>Nenhum usu√°rio cadastrado</h3>
      <p>Clique em "Novo Usu√°rio" para adicionar o primeiro usu√°rio!</p>
    </div>
  </div>
</div> 